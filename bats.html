<!DOCTYPE HTML>
<!--Story by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)-->

<html>
	<head>
		<title>James McGlynn</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/coreui-icons-master/css/all.min.css" />
		<link rel="stylesheet" href="assets/css/custom.css" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<link rel="stylesheet" href="assets/css/floating-nav.css" />
	</head>

	<body class="is-preload">

		<!-- Floating Nav -->
		<div class="floating-nav">
			<div class = "floating-nav-bg"></div>
			<div class = "floating-nav-icons-container">
				<ul>
					<li><a class="nav smooth-scroll" href="#welcome"><span>Top</span><i class="nav fas fa-chevron-up"></i></a></li>
					<li><a class="nav" href="index.html"><span>Home</span><i class="nav fas fa-home"></i></a></li>
					<li><a class="nav" href="about-me.html"><span>About Me</span><i class="nav fas fa-portrait"></i></a></li>
					<!-- <li><a class="nav" href="threemusesglass.html"><span>Next Project</span><i class="nav fas fa-chevron-right"></i></a></li> -->
					<!-- <li><a class="nav smooth-scroll" href="#footer"><span>Bottom</span><i class="nav fas fa-chevron-down"></i></a></li> -->
				</ul>
			</div>
			<div class = "floating-nav-trigger"><a class="floating-nav-trigger-style"><i class="fas fa-bars"></i></a></div>
		</div>


		<!-- Wrapper -->
		<div id="wrapper" class="divided">

			<!-- Mosaic Maker Banner -->
			<section class="banner style1 orient-left content-align-center image-position-center fullscreen onload-image-fade-in onload-content-fade-right" id="top">
				<div class="content">
					<h1>BATS</h1>
					<p class="major">The story of how I developed a NYSERDA approved Real Time Energy Management system as the sole technical resource on a team of three.</p>
				</div>
				<div class="image">
					<img src="images/index/rtem.png" alt="" />
				</div>
				<!-- <a href="#goal" class="goto-next goto-next-style1 smooth-scroll"><i class="fas fa-chevron-down"></i></a> -->
			</section>


			<section class="banner style1 orient-right content-align-center image-position-center fullscreen onscroll-image-fade-in color6" id="goal">
				<div class="content">
					<h1>Taking Over</h1>
					<h2>The Setup</h2>
					<p>An employee came to my old company and brought with him a potential service line and some existing clients from his previous company that was dissolving. My company at the time decided to pickup the service line, but rejected the opportunity to buy the existing software used to provide the service from this new employee's old company. I don't actually know why, but I'd like to think it was because it was written in PHP.</p>

					<h2>The Service</h2>
					<p>The service was referred to as Bill Auditing and Tenant Submetering (BATS) and consisted of combining monthly utility data and quarter-hourly submeter data to generate energy bills for our client's tenants. The utility data was being collected using a browser plugin called iMacros that was able to record and parameterize mouse movements and keyboard input in a browser session. The submeter data was being collected from field servers by the old company's software which was going away soon.</p>

					<h2>My First Mission</h2>
					<p>The first thing I needed to figure out was how to get the quarter-hourly data off the field servers. I used the technologies I was most comfortable with and setup a python app hosted on heroku in order to accept logfiles via http push from the field servers. All of the documentation I found for the servers was specific to PHP, but after tons of trial and error I finally arrived at this line of code that let me treat the logfiles sent by the field serves as python file objects. </p>
					<code>file_handle=gzip.GzipFile( fileobj=io.BytesIO( field_storage_object.value ) , mode='r' )</code>
					<p></p>
					<h2>Step 2: Get Carried Away</h2>
					<p> After I finally had a familiar object to work with, I saved the logfiles to AWS S3 before anything bad could happen to them. This ability to retrieve and save the logfiles in a python web application was used by the company from then on, but I also wanted to show off to my coworker so I started putting the data directly into Dynamo DB so I could make some graphs to show them, as if to say I can totally just recreate your entire previous company's software product myself. But when I saw that I was getting charged 30 dollars a month to my personal AWS account for a handfull of datastreams... that part of the operation got shut down pretty quickly. </p>

					<h2>Side Mission</h2>
					<p>After I got the critical stuff taken care of, I also replaced the existing webscraping infrastucture that was using imacros with a more flexible, powerful (and free) one using python and selenium. I designed it so that anyone could write a script and put it in a folder, add a row to a configuration table, and the script would automatically be setup to run on a schedule, retry after failure, and log errors. Scripts were also allowed to loop within themselves so that single logins were used for sites where data from multiple accounts or meters was needed.</p>
				</div>
			</section>


			<section class="banner style1 orient-right content-align-center image-position-center fullscreen onscroll-image-fade-in" id="goal">
				<div class="content">
					<h1>Skyspark!</h1>
					<p>At some point we started to research IOT solutions and landed on Skyspark, which is essentially an IOT solution aimed at HVAC controls. It has it's own scripting language that I quickly became the "resident expert" in and it allowed us to start automating additional portions of the BATS service line.
					<h2>Meter Classification</h2>
					<p>Meter data didn't contain a stripped down uniform model number, and many model numbers that were unique contained the same points, which for this purpose meant they were ostensibly the same. Made a list of regular expressions that mapped to standardized model names to be used with determining what point to collect from each meter. </p>
					<h2>SubID Configuration</h2>
					<p>ID was used to refer to the number associated with a physical device that the field-server would produce a logfile for. To refer to individual columns of the logfile, the term SubID was used.

					For some logfiles, columns were different metrics pertaining to a single physical device, for others, each column referred to a different physical device.

					I didn't want to have to specify which fields to collect for every meter because a new site could have hundreds. I devised a method to look for a matching configuration in the SubID configuration table to determine which fields to collect. The system would go from most specific (site, meter type, meter id, and sub_id all match) to least specific (nothing matches). This method worked well because it allowed default behaviors to be defined and then overridden when necessary. </p>


					<h2>Parallel Hierarchy Tagging Structure</h2>
					<p>
					In order to bill the tenants, you first have to calculate how much energy should be attributed to each of them. Because building layouts change faster than electiricity and metering infrastructure inside a building, this is rarely a straightforward process. 

					Most of the time, if there is any area that a tenant uses for any reason, the landloard wants them to pay their share of the energy used in that area. For space leased by the tenant, all energy consumed in the space is attributed to that tenant. For parking lots, hallways, communal spaces, etc., the energy needs to be divided up in some fair way according to which tenants should be included. 

					Some energy data isn't attributed to a leased space at all and still requires distribution, for example, HVAC equipemnt and roof antanneas. 

					There are many subtleties and complications that can arise with different building layouts, but I feel I was able to capture a huge amount of generality and flexibility with the following method:

					Here is the hierachy:
					Portfolio -> Site -> (Tenant, Zone, Floor) -> Meter -> Point

					Note that Tenant, Zone, and Floor have the same status, so there are essentially three hiearchies that differ in one spot. 
					Using this hierarchy and allowing relationships to exist between all levels of the heiarchy (i.e. children can have multiple parents from anywhere in the heirachy) allowed for automatic distribution from meter data contained in points to make it's way to the tenant, provided that objects in the tree were tagged appropriately. 
					</p>

					<h2>Allocation of Energy</h2>
					<p>The culmination of all of the above efforts was a function called Distribute Usage (great name) that took all the above data and configurations and output a table with a row for every allocation of energy data. Data could come from the site, be directly associated with a tenant, be atributed to a space linked to that tenant, or a floor that that tenant has space on, or an arbitrary collection of spaces of which that tenant is a part of (I called them zones), and more! This table was great because it had all of these sources broken down by their individual contibution so it was easy to track where all the consumption billed to a given tenant was coming from. My coworkers then took this result as well as the utility rates from the web scraping and used the information to generate tenant utiliy bills for our clients (property managers and building owners) to use for billing their tenants.</p>

				</div>
				<!-- <div class="image">
					<img src="images/index/rtem.png" alt="" />
				</div> -->
				<!-- <a href="#definitions" class="goto-next goto-next-style1 smooth-scroll"><i class="fas fa-chevron-down"></i></a> -->
			</section>





			<section class="banner style1 orient-right content-align-center image-position-center fullscreen onscroll-image-fade-in color6" id="goal">
				<div class="content">
					<h1>The Final Push</h1>
					<p>After the above efforts, a couple of tweaks to go from daily uploads to quarter-hourly uploads, increase security, and display some functionality we didn't need outside of the application, we were able to become a NYSERDA Approved RTEM Service Vendor. Over the course of the project, I had help with project management ond overall direction, but I was always the sole technical resource. Outside of the application, the platform we developed was used for xxx of dollars of services every year and was still in use when I left the company.</p>
				</div>
				<!-- <div class="image">
					<img src="images/index/rtem.png" alt="" />
				</div> -->
				<!-- <a href="#definitions" class="goto-next goto-next-style1 smooth-scroll"><i class="fas fa-chevron-down"></i></a> -->
			</section>

	
	 

			<!-- Footer -->
			<section class="banner style3 orient-left content-align-center image-position-center fullscreen onscroll-image-fade-in" id="footer">
				<div class="content">
					<h2 class="header-custom">James McGlynn</h2>
					<p><i>Engineer, Programmer</i></p>
					<p></p>
					<ul class="icons ul-custom">
						<li>
							<a target="_blank" href="https://github.com/wantsomechocolate" class="icon brands style2 fa-github">
								<i class="label">Github</i>
							</a>
						</li>
						<li>
							<a target="_blank" href="https://stackoverflow.com/users/1937423/wantsomechocolate" class="icon brands style2 fa-stack-overflow">
								<i class="label">StackOverflow</i>
							</a>
						</li>
						<li>
							<a target="_blank" href="https://www.linkedin.com/in/james-mcglynn/" class="icon brands style2 fa-linkedin-in">
								<i class="label">LinkedIn</i>
							</a>
						</li>
						<li>
							<a target="_blank" href="https://leetcode.com/wantsomechocolate/" class="icon style2 icon-test icon-custom style2-custom">
								<i class="label-custom cib-leetcode"></i>
							</a>
						</li>
						<li>
							<a target="_blank" href="https://www.facebook.com/JGlynnius" class="icon brands style2 fa-facebook-f">
								<span class="label">Facebook</span>
							</a>
						</li>

						<li>
							<a target="_blank" href="https://www.instagram.com/wantsomegraham/" class="icon brands style2 fa-instagram">
								<span class="label">Instagram</span>
							</a>
						</li>
					</ul>
				</div>
				<div class="image">
					<img src="images/index/portrait.jpg" alt="" />
				</div>
			</section>

		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/jquery.scrolly.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>		
		<script src="assets/js/custom.js"></script>

	</body>
</html>

